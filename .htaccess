# Block access to Jekyll config and any backups/variants
<FilesMatch "^_config\.ya?ml(\..*)?$">
  Require all denied
</FilesMatch>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # ----------------------------
  # Kirby under /projects
  # ----------------------------
  # If request is /projects or /projects/*, let Kirby handle it.
  RewriteRule ^projects(/.*)?$ /projects/index.php [QSA,L]

  # CSS
  RewriteCond %{HTTP:Accept-Encoding} br
  RewriteCond %{REQUEST_FILENAME}.br -s
  RewriteRule ^(.+)\.css$ $1.css.br [QSA,L]

  # JS
  RewriteCond %{HTTP:Accept-Encoding} br
  RewriteCond %{REQUEST_FILENAME}.br -s
  RewriteRule ^(.+)\.js$ $1.js.br [QSA,L]
</IfModule>

<IfModule mod_headers.c>
  <FilesMatch "\.(css|js)\.br$">
    Header set Content-Encoding br
    Header append Vary Accept-Encoding
  </FilesMatch>
</IfModule>

# Ensure correct MIME types for the rewritten files
<IfModule mod_mime.c>
  AddType text/css .css.br
  AddType application/javascript .js.br
</IfModule>

ErrorDocument 404 /404.html
