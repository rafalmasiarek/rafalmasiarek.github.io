document.addEventListener("DOMContentLoaded", () => { const e = document.getElementById("contact-form"), t = document.getElementById("contact-form-alert"), n = document.getElementById("contact-form-btn"), o = document.getElementById("csrf_token"); if (!e || !t || !n || !o) return; fetch("/api/csrf/generate").then(e => e.json()).then(e => { "success" === e.status && e.data.csrf_token && (o.value = e.data.csrf_token) }).catch(e => console.error("CSRF token fetch error:", e)); async function r() { try { const e = await fetch("/api/csrf/regenerate"), t = await e.json(); "success" === t.status && t.data.csrf_token && (o.value = t.data.csrf_token, console.log("CSRF token regenerated and updated.")) } catch (e) { console.error("CSRF token regeneration error:", e) } } setInterval(async () => { try { const e = await fetch("/api/csrf/token-expiry"), t = await e.json(); "success" === t.status && typeof t.data.ttl == "number" && t.data.ttl < 30 && await r() } catch (e) { console.error("CSRF token expiry check error:", e) } }, 1e4), e.addEventListener("submit", async a => { a.preventDefault(); try { n.classList.remove("btn-enable-on-input"), n.classList.add("btn-disable-on-input"), n.disabled = !0, n.innerHTML = '<i class="fas fa-spinner fa-spin"></i> &nbsp; Sending...'; const a = new FormData(e), c = e.dataset.recaptchaSitekey; if (c && typeof grecaptcha != "undefined") { const e = await grecaptcha.execute(c, { action: "contactform" }); a.set("g-recaptcha-response", e) } const s = await fetch("/api/contactform-send", { method: "POST", body: a }), l = await s.json(); t.classList.remove("alert-green", "alert-red"), t.textContent = l.message || "Unexpected response.", t.classList.add(l.status === "success" ? "alert-green" : "alert-red"), t.style.display = "block", l.status === "success" && e.reset() } catch (e) { console.error("Contact form error:", e), t.classList.remove("alert-green"), t.classList.add("alert-red"), t.textContent = "‚ùå Unexpected error occurred.", t.style.display = "block" } finally { n.classList.remove("btn-disable-on-input"), n.classList.add("btn-enable-on-input"), n.disabled = !1, n.innerHTML = '<i class="fas fa-paper-plane"></i> &nbsp; Send Email' } }) });