document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("contact-form"),t=document.getElementById("contact-form-alert"),n=document.getElementById("contact-form-btn");if(!e||!t||!n)return;const a=e.dataset.recaptchaSitekey;fetch("/api/csrf-token").then(e=>e.json()).then(e=>{const a=document.getElementById("csrf_token");a&&"success"===e.status&&(a.value=e.data.csrf_token)}).catch(e=>console.error("CSRF token fetch error:",e)),e.addEventListener("submit",async(r)=>{r.preventDefault();try{n.classList.remove("btn-enable-on-input"),n.classList.add("btn-disable-on-input"),n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin"></i> &nbsp; Sending...';const r=new FormData(e);if(a){const e=await grecaptcha.execute(a,{action:"contactform"});r.set("g-recaptcha-response",e)}const s=await fetch("/api/contactform-send",{method:"POST",body:r}),o=await s.json();t.classList.remove("alert-green","alert-red"),t.textContent=o.message||"Unexpected response.",t.classList.add("success"===o.status?"alert-green":"alert-red"),t.style.display="block","success"===o.status&&e.reset()}catch(e){console.error("Contact form error:",e),t.classList.remove("alert-green"),t.classList.add("alert-red"),t.textContent="‚ùå Unexpected error occurred.",t.style.display="block"}finally{n.classList.remove("btn-disable-on-input"),n.classList.add("btn-enable-on-input"),n.disabled=!1,n.innerHTML='<i class="fas fa-paper-plane"></i> &nbsp; Send Email'}})});
