document.addEventListener("DOMContentLoaded", () => { const e = document.getElementById("contact-form"), t = document.getElementById("contact-form-alert"), n = document.getElementById("contact-form-btn"); if (!e || !t || !n) return; const r = e.dataset.recaptchaSitekey; fetch("/api/csrf_token_gen.php").then(e => e.json()).then(e => { const t = document.getElementById("csrf_token"); t && (t.value = e.csrf_token) }).catch(e => console.error("CSRF token fetch error:", e)), e.addEventListener("submit", async a => { a.preventDefault(); try { const a = await grecaptcha.execute(r, { action: "contactform" }); n.classList.remove("btn-enable-on-input"), n.classList.add("btn-disable-on-input"), n.disabled = !0, n.innerHTML = '<i class="fas fa-spinner fa-spin"></i> &nbsp; Sending...'; const s = new FormData(e); s.set("g-recaptcha-response", a); const d = await fetch("/api/contactform_send.php", { method: "POST", body: s }), o = await d.json(); t.classList.remove("alert-green", "alert-red"), t.innerHTML = o.result || "Unexpected response", t.classList.add("success" === o.status ? "alert-green" : "alert-red"), t.style.display = "block", e.reset(), n.classList.remove("btn-disable-on-input"), n.classList.add("btn-enable-on-input"), n.disabled = !1, n.innerHTML = '<i class="fas fa-paper-plane"></i> &nbsp; Send Email.' } catch (a) { console.error("Contact form error:", a), t.classList.remove("alert-green"), t.classList.add("alert-red"), t.innerHTML = "‚ùå Unexpected error occurred.", t.style.display = "block", n.classList.remove("btn-disable-on-input"), n.classList.add("btn-enable-on-input"), n.disabled = !1, n.innerHTML = '<i class="fas fa-paper-plane"></i> &nbsp; Send Email.' } }) });